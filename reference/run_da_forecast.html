<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Run ensemble data assimilation and/or produce forecasts"><title>Run ensemble data assimilation and/or produce forecasts — run_da_forecast • FLAREr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run ensemble data assimilation and/or produce forecasts — run_da_forecast"><meta property="og:description" content="Run ensemble data assimilation and/or produce forecasts"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FLAREr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.21</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/flare-config-vignette.html">FLAREr configurations</a>
    <a class="dropdown-item" href="../articles/flare-drivers-vignette.html">FLAREr driver inputs</a>
    <a class="dropdown-item" href="../articles/flare-example-vignette.html">FLAREr example</a>
    <a class="dropdown-item" href="../articles/flare-workflow-vignette.html">Common Workflow</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run ensemble data assimilation and/or produce forecasts</h1>
      
      <div class="d-none name"><code>run_da_forecast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run ensemble data assimilation and/or produce forecasts</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_da_forecast</span><span class="op">(</span></span>
<span>  <span class="va">states_init</span>,</span>
<span>  pars_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">aux_states_init</span>,</span>
<span>  <span class="va">obs</span>,</span>
<span>  <span class="va">obs_sd</span>,</span>
<span>  <span class="va">model_sd</span>,</span>
<span>  <span class="va">working_directory</span>,</span>
<span>  <span class="va">met_file_names</span>,</span>
<span>  inflow_file_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outflow_file_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">config</span>,</span>
<span>  pars_config <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">states_config</span>,</span>
<span>  <span class="va">obs_config</span>,</span>
<span>  management <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  da_method <span class="op">=</span> <span class="st">"enkf"</span>,</span>
<span>  par_fit_method <span class="op">=</span> <span class="st">"inflate"</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  log_wq <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  obs_secchi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  obs_depth <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>states_init</dt>
<dd><p>array of the initial states.  Required dimensions are <code>[states, depths, ensemble]</code></p></dd>


<dt>pars_init</dt>
<dd><p>array of the initial states.  Required dimensions are <code>[pars, depths, ensemble]</code>.  (Default = NULL)</p></dd>


<dt>aux_states_init</dt>
<dd><p>list of initial conditions for auxillary states.  These are states in the GLM that
are require for restarting the model but are not included in data assimilation.  These are states that are not associated
with a value in <code>model_sd</code>.</p></dd>


<dt>obs</dt>
<dd><p>array; array of the observations. Required dimensions are <code>[nobs, time, depth]</code></p></dd>


<dt>obs_sd</dt>
<dd><p>vector; vector of standard deviation for observation</p></dd>


<dt>model_sd</dt>
<dd><p>vector vector of standard deviations describing the model error for each state</p></dd>


<dt>working_directory</dt>
<dd><p>string; full path to directory where model executes</p></dd>


<dt>met_file_names</dt>
<dd><p>vector; vector of full path meteorology file names</p></dd>


<dt>inflow_file_names</dt>
<dd><p>vector or matrix;; vector of inflow file names</p></dd>


<dt>outflow_file_names</dt>
<dd><p>vector or matrix; vector of outflow file names</p></dd>


<dt>config</dt>
<dd><p>list; list of configurations</p></dd>


<dt>pars_config</dt>
<dd><p>list; list of parameter configurations  (Default = NULL)</p></dd>


<dt>states_config</dt>
<dd><p>list; list of state configurations</p></dd>


<dt>obs_config</dt>
<dd><p>list; list of observation configurations</p></dd>


<dt>management</dt>
<dd><p>list; list of management inputs and configuration  (Default = NULL)</p></dd>


<dt>da_method</dt>
<dd><p>string; data assimilation method (enkf or pf; Default = enkf)</p></dd>


<dt>par_fit_method</dt>
<dd><p>string; method for adding noise to parameters during calibration</p></dd>


<dt>debug</dt>
<dd><p>boolean; add extra diagnostics for debugging (Default = FALSE)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list is passed to <code><a href="write_forecast_netcdf.html">write_forecast_netcdf()</a></code> to write the
netcdf output and <code>create_flare_eml()</code> to generate the EML metadata</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Uses the ensemble data assimilation to predict water quality for a lake
or reservoir.  The function requires the initial conditions (<code>states_init</code>) for each
state and ensemble member using an array with the following dimension order:
states, depth, ensembles member.  If you are fitting parameters, it also requires
initial conditions for each parameter and ensemble member using an array (<code>par_init</code>) with the
following dimension order: parameters, ensemble member.  The arrays for states_init
and pars_init can be created using the <code><a href="generate_initial_conditions.html">generate_initial_conditions()</a></code> function, if
starting from initial conditions in the  <code>states_config</code> data frame or from observations
in first time column of the <code>obs</code> array.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">da_forecast_output</span> <span class="op">&lt;-</span> <span class="fu">FLAREr</span><span class="fu">::</span><span class="fu">run_da_forecast</span><span class="op">(</span>states_init <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="va">states</span>,</span></span>
<span class="r-in"><span>    pars_init <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="va">pars</span>, aux_states_init <span class="op">=</span> <span class="va">init</span><span class="op">$</span><span class="va">aux_states_init</span>,</span></span>
<span class="r-in"><span>    obs <span class="op">=</span> <span class="va">obs</span>, obs_sd <span class="op">=</span> <span class="va">obs_config</span><span class="op">$</span><span class="va">obs_sd</span>, model_sd <span class="op">=</span> <span class="va">model_sd</span>,</span></span>
<span class="r-in"><span>    working_directory <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">file_path</span><span class="op">$</span><span class="va">execute_directory</span>,</span></span>
<span class="r-in"><span>    met_file_names <span class="op">=</span> <span class="va">met_file_names</span>, inflow_file_names <span class="op">=</span> <span class="va">inflow_file_names</span>,</span></span>
<span class="r-in"><span>    outflow_file_names <span class="op">=</span> <span class="va">outflow_file_names</span>, config <span class="op">=</span> <span class="va">config</span>,</span></span>
<span class="r-in"><span>    pars_config <span class="op">=</span> <span class="va">pars_config</span>, states_config <span class="op">=</span> <span class="va">states_config</span>,</span></span>
<span class="r-in"><span>    obs_config <span class="op">=</span> <span class="va">obs_config</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by R. Quinn Thomas.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

